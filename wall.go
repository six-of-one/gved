package main

import (
	"fmt"
	"math/rand"
	"regexp"
	"strconv"
	"strings"
)

var reWallNum = regexp.MustCompile(`^wall(\d+)$`)
var reWallColor = regexp.MustCompile(`^c(\d+)$`)
var reWallAdj = regexp.MustCompile(`^(u|ur|r|dr|d|dl|l|ul)$`)

/*

	"image/png"
	"os"

func waltile(stamp *Stamp, cod int, ww int) {
// TEMP - remove
// write all wall seqs as 16x16
imgb := blankimage(2*8, 2*8)
writestamptoimage(imgb, stamp, 0, 0)
wnam := fmt.Sprintf("w%d_%d.png",ww,cod)
wrfile, err := os.Create(wnam)
if err == nil {
	png.Encode(wrfile,imgb)
}
wrfile.Close()
}
*/

func dowall(arg string) {
	split := strings.Split(arg, "-")

	var wallNum = -1
	var wallColor = 0
	var wallAdj = 0

	// Still wonder if there's a cleaner way
	for _, ss := range split {
		switch {
		case reWallNum.MatchString(ss):
			wall, _ := strconv.ParseInt(reWallNum.FindStringSubmatch(ss)[1], 10, 0)
			wallNum = int(wall)
		case reWallColor.MatchString(ss):
			color, _ := strconv.ParseInt(reWallColor.FindStringSubmatch(ss)[1], 10, 0)
			wallColor = int(color)
		case reWallAdj.MatchString(ss):
			res := reWallAdj.FindStringSubmatch(ss)
			if res[1] != "" {
				switch res[1] {
				case "ul":
					wallAdj += 0x01
				case "u":
					wallAdj += 0x02
				case "ur":
					wallAdj += 0x04
				case "l":
					wallAdj += 0x08
				case "r":
					wallAdj += 0x10
				case "dl":
					wallAdj += 0x20
				case "d":
					wallAdj += 0x40
				case "dr":
					wallAdj += 0x80
				}
			}
		}

	}
	fmt.Printf("Wall number: %d   color: %d   adj: %d\n", wallNum, wallColor, wallAdj)

	img := blankimage(2*8, 2*8)
	// t := floorGetTiles(floorNum, floorAdj)
	if wallNum > -1	{
		stamp := wallGetStamp(wallNum, wallAdj, wallColor)

		writestamptoimage(img, stamp, 0, 0)
	} else {
// on wallnum = -1 (default or invalid) write entire wall seq on top of sample floor
		stamp := floorGetStamp(1, 0, 0)
		img = blankimage(2*16 * 13.5, 2*16 * 6)
		if wallColor == 0 {
			img = blankimage(2*16 * 13.5, 2*16 * 8)
		}
		for x := 0; x < 447; x = x +16 {
		for y := 0; y < 255; y = y +16 {
			writestamptoimage(img, stamp, x, y)
		}}

// for all wallnum flavours, display each segment
		for w := 0; w < 8; w++ {
// 1 unit wall
			stamp = wallGetStamp(w, 1, wallColor)
			writestamptoimage(img, stamp, 8, 8 + w * 32)
// temp - remove all tehse
//waltile(stamp, 1, w)

// end caps for Õ, â†„, Õˆ, â…½
			stamp = wallGetStamp(w, 2, wallColor)
			writestamptoimage(img, stamp, 8 + 24, 8 + w * 32)
//waltile(stamp, 2, w)
			stamp = wallGetStamp(w, 8, wallColor)
			writestamptoimage(img, stamp, 8 + 48, 8 + w * 32)
//waltile(stamp, 8, w)
			stamp = wallGetStamp(w, 64, wallColor)
			writestamptoimage(img, stamp, 8 + 72, 8 + w * 32)
//waltile(stamp, 64, w)
			stamp = wallGetStamp(w, 16, wallColor)
			writestamptoimage(img, stamp, 8 + 96, 8 + w * 32)
//waltile(stamp, 16, w)
// corners ðŸ­¿, ðŸ­¼, ðŸ­½, ðŸ­¾
			stamp = wallGetStamp(w, 10, wallColor)
			writestamptoimage(img, stamp, 8 + 120, 8 + w * 32)
//waltile(stamp, 10, w)
			stamp = wallGetStamp(w, 18, wallColor)
			writestamptoimage(img, stamp, 8 + 144, 8 + w * 32)
//waltile(stamp, 18, w)
			stamp = wallGetStamp(w, 80, wallColor)
			writestamptoimage(img, stamp, 8 + 168, 8 + w * 32)
//waltile(stamp, 80, w)
			stamp = wallGetStamp(w, 72, wallColor)
			writestamptoimage(img, stamp, 8 + 192, 8 + w * 32)
//waltile(stamp, 72, w)
// | and â”€
			stamp = wallGetStamp(w, 66, wallColor)
			writestamptoimage(img, stamp, 8 + 216, 8 + w * 32)
//waltile(stamp, 66, w)
			stamp = wallGetStamp(w, 24, wallColor)
			writestamptoimage(img, stamp, 8 + 240, 8 + w * 32)
//waltile(stamp, 24, w)
// â”¼
			stamp = wallGetStamp(w, 90, wallColor)
			writestamptoimage(img, stamp, 8 + 264, 8 + w * 32)
//waltile(stamp, 90, w)
// t's: â”¤, â”´, â”œ, â”¬
			stamp = wallGetStamp(w, 66 + 8, wallColor)
			writestamptoimage(img, stamp, 8 + 288, 8 + w * 32)
//waltile(stamp, 66+8, w)
			stamp = wallGetStamp(w, 24 + 2, wallColor)
			writestamptoimage(img, stamp, 8 + 312, 8 + w * 32)
//waltile(stamp, 24+2, w)
			stamp = wallGetStamp(w, 66 + 16, wallColor)
			writestamptoimage(img, stamp, 8 + 336, 8 + w * 32)
//waltile(stamp, 66+16, w)
			stamp = wallGetStamp(w, 24 + 64, wallColor)
			writestamptoimage(img, stamp, 8 + 360, 8 + w * 32)
//waltile(stamp, 24+64, w)
// ðŸ®˜
			stamp = wallGetStamp(w, 255, wallColor)
			writestamptoimage(img, stamp, 8 + 384, 8 + w * 32)
//waltile(stamp, 255, w)
			}
		}

	savetopng(opts.Output, img)
}

func wallGetTiles(wallNum int, wallAdj int) []int {
	t := make([]int, 4)
	wm := wallMap
	st := wallStamps

	// shrub level, but not 6 or 11
	if wallNum >= 6 && wallNum != 6 && wallNum != 11 {
		adder := 0
		if wallNum == 7 || wallNum == 12 {
			adder = 6
		}

		adder = 0

		rand := +rand.Intn(6)
		for i := 0; i < 4; i++ {
			t[i] = shrubOtherOrderStamps[rand+adder][i]
		}

		return t
	}

	// shrub level, exactly 6 or 11
	if wallNum >= 6 {
		wm = shrubWallMap
		st = shrubStamps
		wallNum = 0
	}

	for i := 0; i < 4; i++ {
		m := wm[wallAdj]
		t[i] = st[(68*wallNum)+m][i]
	}

	return t
}

func wallGetStamp(wallNum int, wallAdj int, wallColor int) *Stamp {
	tiles := wallGetTiles(wallNum, wallAdj)
	wp := "wall"
	wc := wallColor

	// if wallNum == 6 || wallNum == 11 {
	// if wallNum == 7 || wallNum == 12 {
	if wallNum >= 6 {
		wp = "shrub"
		wc = 0
	}
	stamp := genstamp_fromarray(tiles, 2, wp, wc)

	// spew.Dump(stamp)
	return stamp
}

func wallGetDestructableStamp(wallNum int, wallAdj int, wallColor int) *Stamp {
	if wallNum < 6 {
		return wallGetStamp(5, wallAdj, wallColor)
	}

	tiles := shrubDestructStamps[0]
	stamp := genstamp_fromarray(tiles, 2, "shrub", 0)

	return stamp
}

var wallStamps = [][]int{
	// 0
	{0x1C1, 0x1C2, 0x1C3, 0x1C4},
	{0x1C5, 0x1C5, 0x1C6, 0x1C6},
	{0x1C7, 0x1C8, 0x1C6, 0x1C6},
	{0x1C9, 0x1CA, 0x1C9, 0x1CA},
	{0x1C5, 0x1CB, 0x1C6, 0x1CC},
	{0x1CD, 0x1CE, 0x1C9, 0x1CA},
	{0x1C5, 0x1C5, 0x1CF, 0x1D0},
	{0x1C9, 0x1C8, 0x1C9, 0x1D0},
	{0x1C7, 0x1CA, 0x1CF, 0x1CA},
	{0x1D1, 0x1C5, 0x1C9, 8},
	{0x1C5, 0x1C5, 8, 8},
	{0x1C5, 0x1D2, 8, 0x1CA},
	{0x1C9, 8, 0x1C9, 8},
	{8, 8, 8, 8},
	{8, 0x1CA, 8, 0x1CA},
	{0x1C9, 8, 0x1D3, 0x1C6},
	{8, 8, 0x1C6, 0x1C6},
	{8, 0x1CA, 0x1C6, 0x1D4},
	{0x1D1, 0x1D2, 0x1D3, 0x1D4},
	{0x1D5, 0x1D6, 0x1D7, 0x1D8},
	{0x1D1, 0x1C5, 0x1C9, 0x1D0},
	{0x1C5, 0x1D2, 0x1D9, 0x1CA},
	{0x1C9, 0x1C8, 0x1D3, 0x1C6},
	{0x1DA, 0x1CA, 0x1C6, 0x1DB},
	{8, 8, 8, 0x1D0},
	{8, 8, 0x1CF, 8},
	{8, 0x1C8, 8, 8},
	{0x1DA, 8, 8, 8},
	{0x1C9, 0x1C8, 0x1DC, 0x1D0},
	{0x1C9, 0x1CA, 0x1DC, 0x1CA},
	{0x1CD, 0x1CE, 0x1DC, 0x1CA},
	{0x1C5, 0x1C5, 0x1DD, 0x1C6},
	{0x1D1, 0x1C5, 0x1DC, 8},
	{0x1DA, 8, 0x1C6, 0x1C6},
	{8, 0x1CA, 0x1DE, 0x1CA},
	{8, 0x1DF, 0x1C6, 0x1C6},
	{0x1C9, 8, 0x1C9, 0x1D0},
	{0x1C9, 8, 0x1E0, 8},
	{0x1C7, 0x1CA, 0x1DD, 0x1DB},
	{0x1D1, 0x1C5, 0x1DC, 0x1D0},
	{0x1C7, 0x1C8, 0x1CF, 0x1D0},
	{8, 0x1C8, 0x1CF, 0x1D0},
	{0x1C7, 8, 0x1CF, 0x1D0},
	{0x1C7, 0x1C8, 8, 0x1D0},
	{0x1C7, 0x1C8, 0x1CF, 8},
	{8, 8, 0x1CF, 0x1D0},
	{0x1C7, 0x1C8, 8, 8},
	{8, 0x1C8, 8, 0x1D0},
	{0x1C7, 8, 0x1CF, 8},
	{8, 0x1C8, 0x1CF, 8},
	{0x1C7, 8, 8, 0x1D0},
	{0x1C1, 0x1C2, 0x1E1, 0x1C4},
	{0x1E2, 0x1E3, 0x1E4, 0x1D8},
	{8, 8, 0x1DD, 0x1C6},
	{0x1D1, 0x1D2, 0x1E5, 0x1D4},
	{0x1C5, 0x1CB, 0x1DD, 0x1CC},
	{8, 0x1CA, 0x1DD, 0x1D4},
	{0x1C9, 0x1C8, 0x1E5, 0x1C6},
	{0x1C9, 8, 0x1E5, 0x1C6},
	{0x1C7, 0x1C8, 0x1DD, 0x1C6},
	{8, 0x1DF, 0x1DD, 0x1C6},
	{0x1DA, 8, 0x1DD, 0x1C6},
	{0x1C7, 0x1CA, 8, 0x1CA},
	{0x1C9, 8, 0x1DC, 0x1D0},
	{0x1C5, 0x1C5, 8, 0x1D0},
	{0x1C9, 0x1C8, 0x1C9, 8},
	{0x1C5, 0x1C5, 0x1CF, 8},
	{0x1C9, 0x1C8, 0x1DC, 8},

	// 1
	{0x1E6, 0x1E7, 0x1E8, 0x1E9},
	{0x1EA, 0x1EA, 0x1EB, 0x1EC},
	{0x1ED, 0x1EE, 0x1EB, 0x1EC},
	{0x1EF, 0x1F0, 0x1F1, 0x1F2},
	{0x1EA, 0x1F3, 0x1F4, 0x1F5},
	{0x1F6, 0x1F7, 0x1F1, 0x1F8},
	{0x1EA, 0x1EA, 0x1F9, 0x1FA},
	{0x1FB, 0x1EE, 0x1FC, 0x1FA},
	{0x1ED, 0x1FD, 0x1FE, 0x1FF},
	{0x200, 0x201, 0x1F1, 0x202},
	{0x201, 0x201, 0x202, 0x202},
	{0x1EA, 0x203, 0x204, 0x1FF},
	{0x1EF, 0x205, 0x1F1, 0x202},
	{0x205, 0x205, 0x202, 0x202},
	{0x202, 0x1FD, 0x204, 0x1FF},
	{0x1FB, 0x202, 0x206, 0x207},
	{0x202, 0x202, 0x208, 0x207},
	{0x202, 0x1FD, 0x208, 0x209},
	{0x20A, 0x20B, 0x206, 0x209},
	{0x20C, 0x20D, 0x20E, 0x20F},
	{0x20A, 0x1EA, 0x1FC, 0x1FA},
	{0x1EA, 0x210, 0x1F9, 0x1FF},
	{0x1FB, 0x211, 0x206, 0x207},
	{0x212, 0x1FD, 0x208, 0x209},
	{0x205, 0x205, 0x202, 0x213},
	{0x205, 0x205, 0x214, 0x202},
	{0x205, 0x215, 0x202, 0x202},
	{0x216, 0x217, 0x202, 0x202},
	{0x1FB, 0x1EE, 0x218, 0x219},
	{0x1EF, 0x21A, 0x21B, 0x21C},
	{0x21D, 0x21E, 0x21F, 0x1F8},
	{0x1EA, 0x1EA, 0x220, 0x207},
	{0x200, 0x201, 0x21F, 0x202},
	{0x212, 0x202, 0x208, 0x207},
	{0x202, 0x1FD, 0x1F9, 0x1FF},
	{0x202, 0x221, 0x208, 0x207},
	{0x1FB, 0x202, 0x1FC, 0x219},
	{0x1EF, 0x205, 0x21F, 0x202},
	{0x212, 0x1FD, 0x220, 0x209},
	{0x20A, 0x1EA, 0x218, 0x219},
	{0x222, 0x1EE, 0x1F9, 0x219},
	{0x202, 0x1EE, 0x1F9, 0x219},
	{0x222, 0x202, 0x1F9, 0x219},
	{0x223, 0x215, 0x202, 0x224},
	{0x223, 0x215, 0x214, 0x202},
	{0x225, 0x225, 0x1F9, 0x219},
	{0x226, 0x227, 0x202, 0x202},
	{0x205, 0x228, 0x202, 0x224},
	{0x226, 0x205, 0x214, 0x202},
	{0x229, 0x227, 0x214, 0x202},
	{0x226, 0x205, 0x202, 0x224},
	{0x1E6, 0x1E7, 0x22A, 0x1E9},
	{0x22B, 0x20D, 0x22C, 0x20F},
	{0x202, 0x202, 0x220, 0x207},
	{0x20A, 0x22D, 0x22E, 0x22F},
	{0x1EA, 0x1F3, 0x230, 0x1F5},
	{0x202, 0x231, 0x220, 0x22F},
	{0x1FB, 0x1EE, 0x232, 0x207},
	{0x1FB, 0x202, 0x22E, 0x207},
	{0x1ED, 0x1EE, 0x220, 0x1EC},
	{0x202, 0x221, 0x220, 0x207},
	{0x212, 0x202, 0x220, 0x207},
	{0x1ED, 0x1FD, 0x204, 0x1FF},
	{0x1FB, 0x202, 0x218, 0x219},
	{0x233, 0x233, 0x202, 0x224},
	{0x1EF, 0x215, 0x1F1, 0x202},
	{0x201, 0x201, 0x214, 0x202},
	{0x1EF, 0x234, 0x21F, 0x202},

	// 2
	{0x235, 0x236, 0x237, 0x238},
	{0x239, 0x23A, 0x23B, 0x23C},
	{0x23D, 0x23E, 0x23F, 0x23F},
	{0x240, 0x241, 0x242, 0x241},
	{0x243, 0x244, 0x245, 0x246},
	{0x247, 0x248, 0x249, 0x24A},
	{0x243, 0x24B, 0x24C, 0x24D},
	{0x24E, 0x24F, 0x250, 0x251},
	{0x252, 0x253, 0x24C, 0x254},
	{0x255, 0x256, 0x257, 0x258},
	{0x259, 0x256, 0x25A, 0x258},
	{0x25B, 0x25C, 0x25D, 0x25E},
	{0x257, 0x258, 0x257, 0x258},
	{0x25A, 0x25F, 0x25A, 0x258},
	{0x260, 0x261, 0x25A, 0x261},
	{0x262, 0x25F, 0x263, 0x264},
	{0x25A, 0x258, 0x265, 0x266},
	{0x267, 0x268, 0x23F, 0x269},
	{0x26A, 0x26B, 0x26C, 0x26D},
	{0x26E, 0x26F, 0x1D7, 0x270},
	{0x26A, 0x271, 0x250, 0x251},
	{0x243, 0x272, 0x273, 0x274},
	{0x275, 0x24F, 0x26C, 0x276},
	{0x277, 0x278, 0x245, 0x279},
	{0x267, 0x267, 0x27A, 0x27B},
	{0x25A, 0x25F, 0x27C, 0x27D},
	{0x260, 0x27E, 0x25A, 0x25F},
	{0x27F, 0x25F, 0x25A, 0x25F},
	{0x280, 0x24F, 0x281, 0x251},
	{0x257, 0x282, 0x283, 0x282},
	{0x284, 0x285, 0x286, 0x287},
	{0x23A, 0x23A, 0x288, 0x289},
	{0x28A, 0x256, 0x283, 0x28B},
	{0x28C, 0x267, 0x28D, 0x28D},
	{0x25A, 0x282, 0x28E, 0x28F},
	{0x290, 0x291, 0x292, 0x276},
	{0x293, 0x294, 0x295, 0x24D},
	{0x257, 0x258, 0x296, 0x25F},
	{0x297, 0x298, 0x299, 0x29A},
	{0x29B, 0x271, 0x29C, 0x251},
	{0x29D, 0x24F, 0x24C, 0x251},
	{0x267, 0x29E, 0x29F, 0x2A0},
	{0x2A1, 0x267, 0x29F, 0x2A0},
	{0x2A1, 0x29E, 0x2A2, 0x2A3},
	{0x2A1, 0x29E, 0x29F, 0x2A4},
	{0x267, 0x267, 0x29F, 0x2A5},
	{0x2A6, 0x2A7, 0x2A8, 0x2A9},
	{0x290, 0x24F, 0x2AA, 0x2AB},
	{0x2AC, 0x267, 0x27C, 0x2A4},
	{0x267, 0x29E, 0x29F, 0x2A4},
	{0x2AD, 0x258, 0x2AE, 0x2AF},
	{0x235, 0x236, 0x2B0, 0x2B1},
	{0x2B2, 0x2B3, 0x1E4, 0x270},
	{0x267, 0x267, 0x288, 0x289},
	{0x2B4, 0x2B5, 0x2B6, 0x2B7},
	{0x2B8, 0x2B9, 0x2BA, 0x2BB},
	{0x267, 0x2BC, 0x2BD, 0x2BE},
	{0x2BF, 0x24F, 0x2B6, 0x2C0},
	{0x2C1, 0x258, 0x2C2, 0x2C3},
	{0x252, 0x2C4, 0x2C5, 0x2C6},
	{0x267, 0x2C7, 0x2C8, 0x276},
	{0x27F, 0x25F, 0x2C9, 0x2CA},
	{0x2AD, 0x253, 0x25A, 0x282},
	{0x242, 0x258, 0x29C, 0x24D},
	{0x23A, 0x271, 0x2CB, 0x2CC},
	{0x2C1, 0x27E, 0x2CD, 0x258},
	{0x243, 0x256, 0x24C, 0x2CE},
	{0x242, 0x2CF, 0x283, 0x258},

	// 3
	{0x2D0, 0x2D1, 0x2D2, 0x2D3},
	{0x2D4, 0x2D4, 0x2D5, 0x2D6},
	{0x2D7, 0x2D8, 0x2D5, 0x2D6},
	{0x2D9, 0x2DA, 0x2DB, 0x2DC},
	{0x2DD, 0x2DE, 0x2DF, 0x2E0},
	{0x2E1, 0x2E2, 0x2DB, 0x2DC},
	{0x2D4, 0x2D4, 0x2E3, 0x2E4},
	{0x2D9, 0x2E5, 0x2DB, 0x2E4},
	{0x2E6, 0x2DA, 0x2E3, 0x2DC},
	{0x2E7, 0x2E8, 0x2DB, 0x2E9},
	{0x2D4, 0x2D4, 0x2EA, 0x2E9},
	{0x2EB, 0x2EC, 0x2EA, 0x2DC},
	{0x2D9, 0x2ED, 0x2DB, 0x2E9},
	{0x2EE, 0x2ED, 0x2EA, 0x2E9},
	{0x2EE, 0x2DA, 0x2EA, 0x2DC},
	{0x2D9, 0x2ED, 0x2EF, 0x2F0},
	{0x2EE, 0x2ED, 0x2D5, 0x2D6},
	{0x2EE, 0x2DA, 0x2F1, 0x2F2},
	{0x2F3, 0x2EC, 0x2EF, 0x2F4},
	{0x2F5, 0x2F6, 0x2F7, 0x2F8},
	{0x2E7, 0x2E8, 0x2DB, 0x2E4},
	{0x2EB, 0x2EC, 0x2E3, 0x2DC},
	{0x2D9, 0x2F9, 0x2EF, 0x2F0},
	{0x2FA, 0x2DA, 0x2F1, 0x2F2},
	{0x2EE, 0x2ED, 0x2EA, 0x2E4},
	{0x2EE, 0x2ED, 0x2E3, 0x2E9},
	{0x2EE, 0x2D8, 0x2EA, 0x2E9},
	{0x2FA, 0x2ED, 0x2EA, 0x2E9},
	{0x2D9, 0x2E5, 0x2FB, 0x2E4},
	{0x2D9, 0x2DA, 0x2FB, 0x2DC},
	{0x2E1, 0x2E2, 0x2FB, 0x2DC},
	{0x2D4, 0x2D4, 0x2FC, 0x2D6},
	{0x2E7, 0x2E8, 0x2FB, 0x2E9},
	{0x2D7, 0x2ED, 0x2D5, 0x2D6},
	{0x2EE, 0x2DA, 0x2E3, 0x2DC},
	{0x2EE, 0x2D8, 0x2D5, 0x2D6},
	{0x2D9, 0x2ED, 0x2DB, 0x2E4},
	{0x2D9, 0x2ED, 0x2FB, 0x2E9},
	{0x2D7, 0x2DA, 0x2FC, 0x2F2},
	{0x2E7, 0x2E8, 0x2FB, 0x2E4},
	{0x2D7, 0x2D8, 0x2E3, 0x2E4},
	{0x2EE, 0x2D8, 0x2E3, 0x2E4},
	{0x2D7, 0x2ED, 0x2E3, 0x2E4},
	{0x2D7, 0x2D8, 0x2EA, 0x2E4},
	{0x2D7, 0x2D8, 0x2E3, 0x2E9},
	{0x2EE, 0x2ED, 0x2E3, 0x2E4},
	{0x2D7, 0x2D8, 0x2EA, 0x2E9},
	{0x2EE, 0x2D8, 0x2EA, 0x2E4},
	{0x2D7, 0x2ED, 0x2E3, 0x2E9},
	{0x2EE, 0x2D8, 0x2E3, 0x2E9},
	{0x2D7, 0x2ED, 0x2EA, 0x2E4},
	{0x2D0, 0x2D1, 0x2FD, 0x2D3},
	{0x2F5, 0x2F6, 0x2FE, 0x2F8},
	{0x2EE, 0x2ED, 0x2FC, 0x2D6},
	{0x2F3, 0x2EC, 0x2FF, 0x2F4},
	{0x2DD, 0x2DE, 0x2FC, 0x2E0},
	{0x2EE, 0x2DA, 0x2FC, 0x2F2},
	{0x2D9, 0x2F9, 0x300, 0x2F0},
	{0x2D9, 0x2ED, 0x300, 0x2F0},
	{0x2D7, 0x2D8, 0x2FC, 0x2D6},
	{0x2EE, 0x2D8, 0x2FC, 0x2D6},
	{0x2D7, 0x2ED, 0x2FC, 0x2D6},
	{0x301, 0x2DA, 0x2EA, 0x2DC},
	{0x2D9, 0x2ED, 0x2FB, 0x2E4},
	{0x2D4, 0x2D4, 0x2EA, 0x2E4},
	{0x2D9, 0x2E5, 0x2DB, 0x302},
	{0x2D4, 0x303, 0x2E3, 0x302},
	{0x2D9, 0x2E5, 0x2FB, 0x302},

	// 4
	{0x304, 0x305, 0x306, 0x307},
	{0x308, 0x309, 0x30A, 0x30B},
	{0x30C, 0x30D, 0x30A, 0x30B},
	{0x30E, 0x30F, 0x310, 0x311},
	{0x308, 0x312, 0x30A, 0x313},
	{0x314, 0x315, 0x310, 0x311},
	{0x316, 0x317, 0x318, 0x319},
	{0x30E, 0x31A, 0x310, 0x319},
	{0x31B, 0x30F, 0x318, 0x311},
	{0x31C, 0x317, 0x310, 0x31D},
	{0x31E, 0x31F, 0x320, 0x321},
	{0x322, 0x323, 0x320, 0x311},
	{0x30E, 0x324, 0x310, 0x325},
	{0x326, 0x327, 0x320, 0x325},
	{0x328, 0x30F, 0x320, 0x311},
	{0x329, 0x32A, 0x32B, 0x30B},
	{0x32C, 0x32A, 0x30A, 0x30B},
	{0x32D, 0x32E, 0x30A, 0x32F},
	{0x31C, 0x323, 0x330, 0x32F},
	{0x331, 0x332, 0x333, 0x334},
	{0x31C, 0x317, 0x310, 0x319},
	{0x322, 0x323, 0x318, 0x311},
	{0x329, 0x30D, 0x32B, 0x30B},
	{0x335, 0x32E, 0x30A, 0x32F},
	{0x326, 0x336, 0x320, 0x337},
	{0x326, 0x327, 0x318, 0x325},
	{0x326, 0x338, 0x320, 0x325},
	{0x339, 0x327, 0x320, 0x325},
	{0x30E, 0x31A, 0x33A, 0x319},
	{0x30E, 0x30F, 0x33A, 0x311},
	{0x314, 0x315, 0x33A, 0x311},
	{0x308, 0x309, 0x33B, 0x30B},
	{0x31C, 0x317, 0x33A, 0x31D},
	{0x30C, 0x32A, 0x30A, 0x30B},
	{0x328, 0x30F, 0x318, 0x311},
	{0x32C, 0x30D, 0x30A, 0x30B},
	{0x30E, 0x336, 0x310, 0x337},
	{0x30E, 0x324, 0x33A, 0x325},
	{0x33C, 0x32E, 0x33B, 0x32F},
	{0x31C, 0x317, 0x33A, 0x319},
	{0x339, 0x33D, 0x318, 0x337},
	{0x326, 0x33D, 0x318, 0x337},
	{0x339, 0x336, 0x318, 0x337},
	{0x339, 0x33D, 0x320, 0x337},
	{0x339, 0x338, 0x318, 0x325},
	{0x326, 0x336, 0x318, 0x337},
	{0x339, 0x338, 0x320, 0x325},
	{0x326, 0x33D, 0x320, 0x337},
	{0x339, 0x327, 0x318, 0x325},
	{0x326, 0x338, 0x318, 0x325},
	{0x339, 0x336, 0x320, 0x337},
	{0x304, 0x305, 0x33E, 0x307},
	{0x331, 0x332, 0x33F, 0x334},
	{0x32C, 0x32A, 0x33B, 0x30B},
	{0x340, 0x323, 0x341, 0x342},
	{0x308, 0x312, 0x33B, 0x313},
	{0x32D, 0x32E, 0x33B, 0x32F},
	{0x343, 0x344, 0x345, 0x346},
	{0x343, 0x32A, 0x345, 0x346},
	{0x30C, 0x30D, 0x33B, 0x30B},
	{0x32C, 0x30D, 0x33B, 0x30B},
	{0x30C, 0x32A, 0x33B, 0x30B},
	{0x31B, 0x30F, 0x320, 0x311},
	{0x30E, 0x336, 0x33A, 0x337},
	{0x316, 0x317, 0x320, 0x319},
	{0x30E, 0x347, 0x310, 0x325},
	{0x316, 0x317, 0x318, 0x31D},
	{0x30E, 0x348, 0x33A, 0x325},

	//5
	{0x349, 0x34A, 0x34B, 0x34C},
	{0x34D, 0x34E, 0x34F, 0x350},
	{0x351, 0x352, 0x34F, 0x350},
	{0x353, 0x354, 0x355, 0x356},
	{0x357, 0x358, 0x359, 0x35A},
	{0x35B, 0x35C, 0x355, 0x35D},
	{0x357, 0x35E, 0x35F, 0x360},
	{0x353, 0x361, 0x355, 0x362},
	{0x363, 0x354, 0x35F, 0x356},
	{0x364, 0x365, 0x355, 0x366},
	{0x367, 0x368, 0x369, 0x36A},
	{0x36B, 0x354, 0x369, 0x356},
	{0x353, 0x36C, 0x355, 0x36A},
	{0x36D, 0x36E, 0x36F, 0x370},
	{0x371, 0x354, 0x369, 0x356},
	{0x372, 0x373, 0x374, 0x375},
	{0x376, 0x377, 0x378, 0x379},
	{0x37A, 0x37B, 0x34F, 0x37C},
	{0x37D, 0x37E, 0x37F, 0x380},
	{0x381, 0x382, 0x383, 0x384},
	{0x364, 0x385, 0x355, 0x362},
	{0x386, 0x387, 0x35F, 0x388},
	{0x372, 0x389, 0x374, 0x375},
	{0x38A, 0x37B, 0x34F, 0x37C},
	{0x36D, 0x36E, 0x36F, 0x362},
	{0x36D, 0x36E, 0x35F, 0x38B},
	{0x36D, 0x38C, 0x36F, 0x38B},
	{0x38D, 0x36E, 0x36F, 0x38B},
	{0x353, 0x361, 0x38E, 0x362},
	{0x353, 0x354, 0x38E, 0x356},
	{0x35B, 0x35C, 0x38E, 0x35D},
	{0x34D, 0x34E, 0x38F, 0x350},
	{0x390, 0x391, 0x38E, 0x366},
	{0x392, 0x377, 0x378, 0x379},
	{0x36D, 0x354, 0x35F, 0x356},
	{0x376, 0x352, 0x378, 0x379},
	{0x353, 0x393, 0x355, 0x362},
	{0x353, 0x36C, 0x38E, 0x36A},
	{0x38A, 0x37B, 0x38F, 0x37C},
	{0x364, 0x365, 0x38E, 0x362},
	{0x351, 0x352, 0x35F, 0x360},
	{0x394, 0x352, 0x35F, 0x360},
	{0x351, 0x36E, 0x35F, 0x360},
	{0x351, 0x352, 0x36F, 0x360},
	{0x351, 0x352, 0x35F, 0x370},
	{0x395, 0x371, 0x35F, 0x360},
	{0x351, 0x352, 0x36F, 0x370},
	{0x394, 0x352, 0x36F, 0x396},
	{0x351, 0x36E, 0x35F, 0x370},
	{0x395, 0x352, 0x35F, 0x370},
	{0x351, 0x36E, 0x36F, 0x360},
	{0x397, 0x389, 0x398, 0x399},
	{0x381, 0x382, 0x398, 0x384},
	{0x376, 0x377, 0x38F, 0x379},
	{0x37D, 0x37E, 0x39A, 0x39B},
	{0x357, 0x358, 0x38F, 0x35A},
	{0x37A, 0x37B, 0x38F, 0x37C},
	{0x372, 0x352, 0x39A, 0x375},
	{0x372, 0x36E, 0x39A, 0x375},
	{0x39C, 0x352, 0x38F, 0x379},
	{0x395, 0x352, 0x38F, 0x379},
	{0x39D, 0x377, 0x38F, 0x379},
	{0x39D, 0x354, 0x369, 0x356},
	{0x353, 0x393, 0x38E, 0x362},
	{0x34D, 0x34E, 0x36F, 0x360},
	{0x353, 0x352, 0x355, 0x36A},
	{0x34D, 0x34E, 0x35F, 0x370},
	{0x353, 0x352, 0x38E, 0x370},
}

// This table is for figuring out which wall segment to use, based on which
// squares around it also have walls. It is extracted from 0x5EE24 in the
// Gauntlet II ROMs
//
// Bits that get set for walls in locations relative to this one:
// up left:    0x01
// up:         0x02
// up right:   0x04
// left:       0x08
// right:      0x10
// down left:  0x20
// down:       0x40
// down right: 0x80

var wallMap = []int{
	0x12, 0x12, 0x13, 0x13, 0x12, 0x12, 0x13, 0x13,
	0x4, 0x4, 0x17, 0x11, 0x4, 0x4, 0x17, 0x11,
	0x0, 0x0, 0x16, 0x16, 0x0, 0x0, 0xF, 0xF,
	0x1, 0x1, 0x2, 0x23, 0x1, 0x1, 0x21, 0x10,
	0x36, 0x36, 0x34, 0x34, 0x36, 0x36, 0x34, 0x34,
	0x37, 0x37, 0x26, 0x38, 0x37, 0x37, 0x26, 0x38,
	0x33, 0x33, 0x39, 0x39, 0x33, 0x33, 0x3A, 0x3A,
	0x1F, 0x1F, 0x3B, 0x3C, 0x1F, 0x1F, 0x3D, 0x35,
	0x5, 0x5, 0x3, 0x3, 0x5, 0x5, 0x3, 0x3,
	0x15, 0x15, 0x8, 0x22, 0x15, 0x15, 0x8, 0x22,
	0x14, 0x14, 0x7, 0x7, 0x14, 0x14, 0x24, 0x24,
	0x6, 0x6, 0x28, 0x29, 0x6, 0x6, 0x2A, 0x2D,
	0x1E, 0x1E, 0x1D, 0x1D, 0x1E, 0x1E, 0x1D, 0x1D,
	0xB, 0xB, 0x3E, 0xE, 0xB, 0xB, 0x3E, 0xE,
	0x27, 0x27, 0x1C, 0x1C, 0x27, 0x27, 0x3F, 0x3F,
	0x40, 0x40, 0x2B, 0x2F, 0x40, 0x40, 0x32, 0x18,
	0x12, 0x12, 0x13, 0x13, 0x12, 0x12, 0x13, 0x13,
	0x4, 0x4, 0x17, 0x11, 0x4, 0x4, 0x17, 0x11,
	0x0, 0x0, 0x16, 0x16, 0x0, 0x0, 0xF, 0xF,
	0x1, 0x1, 0x2, 0x23, 0x1, 0x1, 0x21, 0x10,
	0x36, 0x36, 0x34, 0x34, 0x36, 0x36, 0x34, 0x34,
	0x37, 0x37, 0x26, 0x38, 0x37, 0x37, 0x26, 0x38,
	0x33, 0x33, 0x39, 0x39, 0x33, 0x33, 0x3A, 0x3A,
	0x1F, 0x1F, 0x3B, 0x3C, 0x1F, 0x1F, 0x3D, 0x35,
	0x5, 0x5, 0x3, 0x3, 0x5, 0x5, 0x3, 0x3,
	0x15, 0x15, 0x8, 0x22, 0x15, 0x15, 0x8, 0x22,
	0x9, 0x9, 0x41, 0x41, 0x9, 0x9, 0xC, 0xC,
	0x42, 0x42, 0x2C, 0x31, 0x42, 0x42, 0x30, 0x19,
	0x1E, 0x1E, 0x1D, 0x1D, 0x1E, 0x1E, 0x1D, 0x1D,
	0xB, 0xB, 0x3E, 0xE, 0xB, 0xB, 0x3E, 0xE,
	0x20, 0x20, 0x43, 0x43, 0x20, 0x20, 0x25, 0x25,
	0xA, 0xA, 0x2E, 0x1A, 0xA, 0xA, 0x1B, 0xD,
}

var shrubWallMap = []int{
	0x9, 0x9, 0xA, 0xA, 0x9, 0x9, 0xA, 0xA,
	0x4, 0x4, 0xE, 0xE, 0x4, 0x4, 0xE, 0xE,
	0x0, 0x0, 0xD, 0xD, 0x0, 0x0, 0xD, 0xD,
	0x1, 0x1, 0x2, 0x2, 0x1, 0x1, 0x2, 0x2,
	0x9, 0x9, 0xA, 0xA, 0x9, 0x9, 0xA, 0xA,
	0x4, 0x4, 0xE, 0xE, 0x4, 0x4, 0xE, 0xE,
	0x0, 0x0, 0xD, 0xD, 0x0, 0x0, 0xD, 0xD,
	0x1, 0x1, 0x2, 0x2, 0x1, 0x1, 0x2, 0x2,
	0x5, 0x5, 0x3, 0x3, 0x5, 0x5, 0x3, 0x3,
	0xC, 0xC, 0x8, 0x8, 0xC, 0xC, 0x8, 0x8,
	0xB, 0xB, 0x7, 0x7, 0xB, 0xB, 0x7, 0x7,
	0x6, 0x6, 0xF, 0xF, 0x6, 0x6, 0xF, 0xF,
	0x5, 0x5, 0x3, 0x3, 0x5, 0x5, 0x3, 0x3,
	0xC, 0xC, 0x8, 0x8, 0xC, 0xC, 0x8, 0x8,
	0xB, 0xB, 0x7, 0x7, 0xB, 0xB, 0x7, 0x7,
	0x6, 0x6, 0xF, 0xF, 0x6, 0x6, 0xF, 0xF,
	0x9, 0x9, 0xA, 0xA, 0x9, 0x9, 0xA, 0xA,
	0x4, 0x4, 0xE, 0xE, 0x4, 0x4, 0xE, 0xE,
	0x0, 0x0, 0xD, 0xD, 0x0, 0x0, 0xD, 0xD,
	0x1, 0x1, 0x2, 0x2, 0x1, 0x1, 0x2, 0x2,
	0x9, 0x9, 0xA, 0xA, 0x9, 0x9, 0xA, 0xA,
	0x4, 0x4, 0xE, 0xE, 0x4, 0x4, 0xE, 0xE,
	0x0, 0x0, 0xD, 0xD, 0x0, 0x0, 0xD, 0xD,
	0x1, 0x1, 0x2, 0x2, 0x1, 0x1, 0x2, 0x2,
	0x5, 0x5, 0x3, 0x3, 0x5, 0x5, 0x3, 0x3,
	0xC, 0xC, 0x8, 0x8, 0xC, 0xC, 0x8, 0x8,
	0xB, 0xB, 0x7, 0x7, 0xB, 0xB, 0x7, 0x7,
	0x6, 0x6, 0xF, 0xF, 0x6, 0x6, 0xF, 0xF,
	0x5, 0x5, 0x3, 0x3, 0x5, 0x5, 0x3, 0x3,
	0xC, 0xC, 0x8, 0x8, 0xC, 0xC, 0x8, 0x8,
	0xB, 0xB, 0x7, 0x7, 0xB, 0xB, 0x7, 0x7,
	0x6, 0x6, 0xF, 0xF, 0x6, 0x6, 0xF, 0xF,
}

// Shrubs w/ mapped stamps (change based on surroundings)
var shrubStamps = [][]int{
	{0x73B, 0x73C, 0x73D, 0x73E},
	{0x73F, 0x740, 0x741, 0x742},
	{0x743, 0x744, 0x745, 0x746},
	{0x747, 0x748, 0x749, 0x74A},
	{0x74B, 0x74C, 0x74D, 0x74E},
	{0x74F, 0x750, 0x751, 0x752},
	{0x753, 0x754, 0x755, 0x756},
	{0x757, 0x758, 0x759, 0x75A},
	{0x75B, 0x75C, 0x75D, 0x75E},
	{0x75F, 0x760, 0x761, 0x762},
	{0x763, 0x764, 0x765, 0x766},
	{0x767, 0x768, 0x769, 0x76A},
	{0x76B, 0x76C, 0x76D, 0x76E},
	{0x76F, 0x770, 0x771, 0x772},
	{0x773, 0x774, 0x775, 0x776},
	{0x777, 0x778, 0x779, 0x77A},
}

// Destructable shrubs
var shrubDestructStamps = [][]int{
	{0x7a7, 0x7a8, 0x7a9, 0x7aa},
	{0x7ab, 0x7ac, 0x7ad, 0x7ae},
	{0x7af, 0x7b0, 0x7b1, 0x7b2},
}

// Not actually used directly. Not sure if they're used directly in the
// actual Gauntlet code or not. FIXME: figure that out!
var shrubOtherStamps = [][]int{
	{0x77B, 0x77C, 0x77D, 0x77E},
	{0x77F, 0x780, 0x781, 0x782},
	{0x783, 0x784, 0x785, 0x786},
	{0x787, 0x788, 0x789, 0x78A},
	{0x78B, 0x78C, 0x78D, 0x78E},
	{0x78F, 0x790, 0x791, 0x792},
	{0x793, 0x794, 0x795, 0x796},
	{0x797, 0x798, 0x799, 0x79A},
	{0x79B, 0x79C, 0x79D, 0x79E},
	{0x79F, 0x7A0, 0x7A1, 0x7A2},
	{0x7A3, 0x7A4, 0x7A5, 0x7A6},
}

// This is the above, but in a different order. It's a table at 0x5EDF4
// in the original code.
var shrubOtherOrderStamps = [][]int{
	{0x77B, 0x77C, 0x77D, 0x77E}, // 0
	{0x77F, 0x780, 0x781, 0x782},
	{0x783, 0x784, 0x785, 0x786},
	{0x787, 0x788, 0x789, 0x78A},
	{0x78B, 0x78C, 0x78D, 0x78E},
	{0x78F, 0x790, 0x791, 0x792},
	{0x797, 0x798, 0x799, 0x79A}, // 6
	{0x793, 0x794, 0x795, 0x796},
	{0x79B, 0x79C, 0x79D, 0x79E},
	{0x79F, 0x7A0, 0x7A1, 0x7A2},
	{0x7A3, 0x7A4, 0x7A5, 0x7A6},
	{0x793, 0x794, 0x795, 0x796},
}

// FIXME: Forcefield stuffs should maybe have its own file
//
// maths for if there's a forcefield in any given direction
// up: 0x01    right: 0x02    down: 0x04    left: 0x08
//
// forcefield generators can be up to 15 spaces away
func ffGetStamp(ffAdj int) *Stamp {
	tiles := ffMap[ffAdj]
	stamp := genstamp_fromarray(tiles, 2, "teleff", 0)
	return stamp
}

var ffMap = [][]int{
	{0xfae, 0x4af, 0x4b0, 0x4b1},
	{0x4a6, 0x4a7, 0x4a8, 0x4a5},
	{0x4a9, 0x4aa, 0x4a8, 0x4ab},
	{0x4a6, 0x4af, 0x4a8, 0x4ab},
	{0x4a9, 0x4a3, 0x4ac, 0x4ad},
	{0x4a6, 0x4a7, 0x4ac, 0x4ad},
	{0x4a9, 0x4aa, 0x4ac, 0x4b1},
	{0x4a6, 0x4af, 0x4ac, 0x4b1},
	{0x4a2, 0x4a3, 0x4a4, 0x4a5},
	{0x4ae, 0x4a7, 0x4a4, 0x4a5},
	{0x4a2, 0x4aa, 0x4a4, 0x4ab},
	{0x4ae, 0x4af, 0x4a4, 0x4ab},
	{0x4a2, 0x4a3, 0x4b0, 0x4ad},
	{0x4ae, 0x4a7, 0x4b0, 0x4ad},
	{0x4a2, 0x4aa, 0x4b0, 0x4b1},
	{0xfae, 0x4af, 0x4b0, 0x4b1},
}
